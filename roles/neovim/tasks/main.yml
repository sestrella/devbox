---
- name: Install package
  community.general.homebrew:
    name:
      - neovim
      # language servers
      - lua-language-server
      - rust-analyzer
      - terraform-ls
  tags: homebrew

- name: Install Docker language server
  community.general.npm:
    name: "{{ item.name }}"
    version: "{{ item.version }}"
    global: true
  loop:
    - { name: "@ansible/ansible-language-server", version: 0.7.2 }
    - { name: "bash-language-server", version: 3.0.4 }
    - { name: "dockerfile-language-server-nodejs", version: 0.9.0 }
    - { name: "yaml-language-server", version: 1.8.0 }

- name: Symlink config file
  ansible.builtin.file:
    src: "{{ role_path }}/files/config"
    dest: ~/.config/nvim
    state: link
  tags: dotfiles

- name: Copy fish config
  ansible.builtin.file:
    src: "{{ role_path }}/files/neovim.fish"
    dest: ~/.config/fish/conf.d/neovim.fish
    state: link
    force: true
  when: ansible_user_shell == "/usr/local/bin/fish"
  tags:
    - dotfiles
    - fish

- name: Create docker-langserver wrapper
  ansible.builtin.template:
    src: "{{ item }}.j2"
    dest: "~/.local/bin/{{ item }}"
    mode: "0755"
  loop:
    - ansible-language-server
    - bash-language-server
    - docker-langserver
    - yaml-language-server
